[nlist=131072]
    [nprobe=1]
    266205513 embeddings loaded in RaBitQ index.
    Loaded 2428854 document lengths
    Loaded 2931 queries, each with 32 embeddings of dimension 128
    Total documents: 2428854, total embeddings: 266205513
    Total found documents: 28758
    start reranking 28758 documents.
    Recall@100: 0.96

    [nprobe=2]
    266205513 embeddings loaded in RaBitQ index.
    Loaded 2428854 document lengths
    Loaded 2931 queries, each with 32 embeddings of dimension 128
    Total documents: 2428854, total embeddings: 266205513
    Total found documents: 61539
    start reranking 61539 documents.
    Recall@100: 0.99

    [nprobe=2, rabitq.nbit=1, qb=4]
    266205513 embeddings loaded in RaBitQ index.
    Loaded 2428854 document lengths
    Loaded 2931 queries, each with 32 embeddings of dimension 128
    Total documents: 2428854, total embeddings: 266205513
    Total found documents: 61539
    start reranking 61539 documents.
    Recall@100: 0.87

1/19
./rabitqex_ivf_gather_est
-index: 
    ivf_rabitq_2097152_5bits_l2
-algorithm:
    Search nprobe=32 nearest clusters for each query embedding. 
    Compute the distances of vectors in the clusters. Use the distance to compute partial matrix.
    Use the partial matrix for ranking, get top-n_stage1=5000 candidates.
    Use rabitq estimated distance to do final (full matrix) reranking.
Avg distance computations: 5000
Recall@100: 0.9281

-index:
    ivf_rabitq_2097152_5bits_l2_noresidual
Recall@100: 0.9241
36.0165 s
>>> Average total gather time: 0.710958 s
>>> Average rerank stage 2 time: 16.965 s
>>> Average gather distance computations: 172245
>>> Average rerank distance computations: 18140023

./rabitqex_ivf_gather_full
-index:
    ivf_rabitq_2097152_5bits_l2_noresidual
Recall@100: 0.9301
10.3138 s
>>> Average total gather time: 2.53225 s
>>> Average rerank stage 2 time: 2.50644 s
>>> Average gather distance computations: 172245
>>> Average rerank distance computations: 18140023

./rabitqex_ivf_est
-index:
    ivf_rabitq_2097152_5bits_l2
-algorithm:
    Search nprobe=32 nearest clusters for each query embedding. 
    Don't compute the distances of vectors in the clusters. Gather all doc ids encountered.
    Use rabitq estimated distance to rank (full matrix) all candidate docs.
Avg distance computations: 26595
Recall@100: 0.9663

-index:
    ivf_rabitq_2097152_5bits_l2_noresidual
Recall@100: 0.9606

./warp
-index:
    ivf_rabitq_2097152_5bits_l2
-algorithm:
    Search nprobe=32 nearest clusters for each query embedding. 
    Compute the distances of vectors in the clusters. Impute the missing distance with centroid score of farthest cluster.
    Directly use the imputed matrix for ranking.
Avg distance computations: 26595
Recall@100: 0.4964

./warp_rerank
-index:
    ivf_rabitq_2097152_5bits_l2
-algorithm:
    Search nprobe=32 nearest clusters for each query embedding. 
    Compute the distances of vectors in the clusters. Impute the missing distance with centroid score of farthest cluster.
    Use the partial matrix for ranking, get top-n_stage1=5000 candidates.
    Use rabitq estimated distance to rank (full matrix) all candidate docs.
Avg distance computations: 5000
Recall@100: 0.9357

nprobe = 128
n_rerank = 20000
Recall@100: 0.9773
>>> Average gather distance computations: 636048
>>> Average rerank distance computations: 70688504

Thoughts:
1. Can optimize efficiency of reranking using rabitq estimated distances?
2. Can imputed distance be better estimated?
3. When reranking with rabitq, use CPU to compute 1bit distance, collect those not filtered,
   send exbits to GPU
   -two layouts for 1bit: cluster compact and document compact 

Observation:
1. dc in reranking is much larger than cg. 
2. Two keys: increase cg accuracy (less reranking needed); increase reranking efficiency.
